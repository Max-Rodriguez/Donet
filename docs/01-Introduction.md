<img src="../logo/donet_banner.png" align="right" width="30%"/>

# 01 - Introduction to Donet

**Donet**[^1] ([/ˈdoʊ.net/](https://en.wikipedia.org/wiki/Help:IPA/English))
is a free and open-source server software, designed for powering massive
multiplayer online games. The design of Donet focuses on solving five
critical problems: Network **culling**, data **persistence**, **security**,
**reliability**, and **scalability**.

The architecture of this project is inspired by the OTP (Online Theme Park)
server, which was developed by Disney Interactive (formerly known as Disney VR
Studios) and used from 2001 to 2013 to power massive multiplayer online games
such as Toontown Online, Pirates of the Caribbean Online, and others. Donet is
licensed under the
[GNU Affero General Public License](https://www.gnu.org/licenses/agpl-3.0.html).

Donet is designed to distribute the workload of operating a virtual world (or
online application) by separating it's fundamental functions into different
services. In a production environment, many instances of Donet can be running in
different machines, each serving a specific role in the cluster while
communicating with each other over the Donet protocol.

[^1]: An acronym for 'Distributed Object Networking'.

## Overview

Distributed Networking is the high-level network API of the Panda3D engine. When
a distributed object is created, all interested clients will automatically
create a copy of that object. Updates to the object will automatically propagate
to the copies. Field updates can be culled according to the rules applied to
object fields via keywords[^2].

[^2]: Modifies behavior of object fields, such as permissions or culling.
Refer to the DC file documentation for more information.

The distributed network is composed of several layers: The DC file (*.dc), is a
[DSL](https://en.wikipedia.org/wiki/Domain-specific_language) which defines
the communication, or the network
[contract](https://en.wikipedia.org/wiki/Design_by_contract), of
your networked application, the Donet cluster which handles communication
between clients, Client/AI Repositories which interact and manage the
Distributed Objects, and the Distributed Objects themselves.

<br>

## Fundamental Terms & Concepts

There are many acronyms that you will find as you read the documentation. Please
review the list below to learn and understand the different concepts and terms.

- **DO**

  Distributed Object. Represents an object present in a State Server's
  visibility tree.

- **DOG**

  Distributed Object Global. Similar to a Distributed Object, but is
  **omnipresent** in the Distributed Object visibility tree. This means that it
  is known globally and always remains accessible by all participants, such as
  Clients and AI processes. DOGs are **useful for authentication**, as anonymous
  (or non-authenticated) clients can interact with a Distributed Object Global
  object, as its not part of the visibility tree and it's DoId is a constant
  that is **globally known** by all clients.

- **DoId**

  Distributed Object Identifier. This is a **32-bit long identifier** that is
  generated by the server at runtime to identify a Distributed Object that
  exists in the State Server.

- **DC**

  Distributed Class. This is a class definition that the developer defines in
  the DC file. Distributed Objects are instantiated based on a Distributed Class
  in which it **inherits** it's properties, or **fields**, from.

- **AI**

  Artificial Intelligence. The name for this is arbitrary, as it is not in any
  way related to the field of machine learning. An AI is a process on the server
  cluster's internal network that acts as a client connected directly to a
  Message Director instance. This means that all AI clients bypass the Client
  Agent, as they are inside of the 'trusted zone[^3].' AI processes have
  **authority over Distributed Objects** and host the game/application's logic.

- **UD**

  Uber DOG. This is similar to an AI process, but is dedicated to managing
  Distributed Object Global (DOGs) objects.

- **Views**

  Views are local implementations of a Distributed Class from different
  **perspectives**. A view is essentially a representation of a Distributed
  Object in the eyes of a client. Distributed Object instances on a client
  inherit from a Distributed Class **and** are usually, by convention, named
  with a suffix which describes the object's perspective from the client's point
  of view in the virtual world. Valid suffixes are: **"AI"** (Artificial
  Intelligence), **"UD"** (UberDOG), and **"OV"** (Owner View).

  **"AI"** views are the AI-side representation of a Distributed Object
  instance.

  **"UD"** views are used by UberDOG processes (similar to AI clients).

  **"OV"** views are used by clients, which have **ownership** over that
  Distributed Object instance.

  Objects seen by a client, but not owned by it, also have their client-side
  representation without a suffix.

  <img src="./images/view_diagram.png" width=70% />

  Each view implements the logic that is executed when a field of the
  Distributed Object is called. For example, a Distributed Class named
  'DistributedAvatar' has AI and OV views. The AI view may have the privilege to
  add currency to the 'DistributedAvatar' object, while the OV view has the
  ability to set the username of the 'DistributedAvatar' object.
  **In a nutshell**, AI processes implement administrative logic for a
  Distributed Object while client processes may implement special logic over
  objects they have ownership of, or use shared logic for objects they do not
  own.

  The concept of views is very similar to the
  [Model-view-controller (MVC)](https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller)
  software design pattern.

- **CR**

  Client Repository. See
  [Panda3D's Client Repository](https://docs.panda3d.org/1.10/python/programming/networking/distributed/client-repositories).

- **AIR**

  AI Repository. See
  [Panda3D's AI Repository](https://docs.panda3d.org/1.10/python/programming/networking/distributed/ai-repositories).

<br>

If you wish to learn more about Panda3D's Distributed Networking, you can also
visit these resources available online:

- [October 2003: Building a MMOG for the Million - Disney's Toontown Online](https://dl.acm.org/doi/10.1145/950566.950589)
- [Apr 16, 2008: The DistributedObject System, client side](https://www.youtube.com/watch?v=JsgCFVpXQtQ)
- [Apr 23, 2008: DistributedObjects and the OTP server](https://www.youtube.com/watch?v=r_ZP9SInPcs)
- [Apr 30, 2008: OTP Server Internals](https://www.youtube.com/watch?v=SzybRdxjYoA)
- [October 2010: (GDC Online) MMO 101 - Building Disney's Server System](https://www.gdcvault.com/play/1013776/MMO-101-Building-Disney-s)
- [(PDF Slideshow) MMO 101 - Building Disney's Server System](https://ubm-twvideo01.s3.amazonaws.com/o1/vault/gdconline10/slides/11516-MMO_101_Building_Disneys_Sever.pdf)

